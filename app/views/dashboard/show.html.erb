<div class="page-header" id="welcome_message">
  <h1>Welcome back, <%= current_user.first_name %></h1>
  <p>Your last visit was <%= distance_of_time_in_words_to_now(current_user.last_sign_in_at) %> ago.</p>

  <ul id="actions">
    <% if current_user.can_create?(LoanEligibilityCheck) %><li><%= link_to "Start New Loan Application", new_eligibility_check_path, class: "btn btn-primary" %></li><% end %>
    <% if current_user.can_view?(Loan::States) %><li><%= link_to "View Loan Portfolio", loan_states_path, class: "btn btn-info" %></li><% end %>

    <% if current_user.can_create?(CfeAdmin) %>
      <li><%= link_to 'Manage CfE Admins', cfe_admins_path, class: 'btn btn-info' %></li>
    <% end %>
    <% if current_user.can_create?(CfeUser) %>
      <li><%= link_to 'Manage CfE Users', cfe_users_path, class: 'btn btn-info' %></li>
    <% end %>
    <% if current_user.can_create?(LenderAdmin) %>
      <li><%= link_to 'Manage Lender Admins', lender_admins_path, class: 'btn btn-info' %></li>
    <% end %>
    <% if current_user.can_create?(AuditorUser) %>
      <li><%= link_to 'Manage Auditor Users', auditor_users_path, class: 'btn btn-info' %></li>
    <% end %>
    <% if current_user.can_create?(PremiumCollectorUser) %>
      <li><%= link_to 'Manage Premium Collector Users', premium_collector_users_path, class: 'btn btn-info' %></li>
    <% end %>
    <% if current_user.can_create?(LenderUser) %>
      <li><%= link_to 'Manage Users', lender_users_path, class: 'btn btn-info' %></li>
    <% end %>
  </ul>
</div>

<% if current_user.can_view?(LoanAlerts) %>
<div class="dashboard_widgets" id="loan_alerts">
  <h2><%= t('dashboard.loan_alerts.title') %></h2>

  <div id="not_progressed_loan_alerts">
    <%= render 'loan_alert',
                presenter: @not_progressed_alerts_presenter,
                title: raw(t('dashboard.loan_alerts.not_progressed')),
                url_helper: :not_progressed_loan_alerts_path %>
  </div>

  <div id="not_drawn_loan_alerts">
    <%= render 'loan_alert',
                presenter: @not_drawn_alerts_presenter,
                title: raw(t('dashboard.loan_alerts.not_drawn')),
                url_helper: :not_drawn_loan_alerts_path %>
  </div>

  <div id="demanded_loan_alerts">
    <%= render 'loan_alert',
                presenter: @demanded_alerts_presenter,
                title: raw(t('dashboard.loan_alerts.demanded')),
                url_helper: :demanded_loan_alerts_path %>
  </div>

  <div id="assumed_repaid_loan_alerts">
    <%= render 'loan_alert',
                presenter: @assumed_repaid_presenter,
                title: raw(t('dashboard.loan_alerts.assumed_repaid')),
                url_helper: :assumed_repaid_loan_alerts_path %>
  </div>
</div>

<% if @utilisation_presenter.has_allocations? %>
<div class="dashboard_widgets" id="utilisation_dashboard">
  <h2><%= t('dashboard.utilisation.title')%></h2>

  <% @utilisation_presenter.each_loan_allocation do |loan_allocation_presenter, index| %>
    <%= render "loan_allocation", loan_allocation_presenter: loan_allocation_presenter, index: index %>
  <% end %>
</div>
<% end %>
<% end %>
